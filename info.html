<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Market Insight</title>
    <style>
        /* [ë””ìì¸] ì–´ë‘ìš´ í…Œë§ˆ ì„¤ì • */
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 80px; /* í•˜ë‹¨ ë©”ë‰´ ê°€ë¦¼ ë°©ì§€ */
        }
        
        /* ìƒë‹¨ í—¤ë” */
        .header {
            padding: 15px 20px;
            background-color: #1e1e1e;
            border-bottom: 1px solid #333;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .header span { color: #F0B90B; margin-left: 5px; }

        /* ê²€ìƒ‰ì°½ ì˜ì—­ */
        .search-container {
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        .search-input {
            flex: 1;
            padding: 12px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            outline: none;
        }
        .search-btn {
            background: #F0B90B;
            color: #000;
            border: none;
            padding: 0 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }

        /* ì°¨íŠ¸ ë°•ìŠ¤ (ê²€ì€ìƒ‰ ë°°ê²½) */
        .chart-card {
            margin: 0 15px;
            background: #000;
            border: 1px solid #333;
            border-radius: 12px;
            height: 250px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        canvas {
            width: 100%;
            height: 100%;
        }

        /* ì •ë³´ í‘œì‹œ ì¹´ë“œ */
        .info-card {
            margin: 15px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 12px;
            text-align: center;
        }
        .badge {
            background: #2a2a2a;
            color: #F0B90B;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 10px;
            display: inline-block;
            border: 1px solid #F0B90B;
        }
        .price-text {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
            letter-spacing: -1px;
        }
        .status-text {
            color: #888;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        /* ì ìˆ˜ ê²Œì´ì§€ */
        .score-row {
            display: flex;
            justify-content: space-between;
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .score-val { color: #F0B90B; font-weight: bold; font-size: 18px; }

        /* í•˜ë‹¨ ë©”ë‰´ë°” */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1e1e1e;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }
        .nav-item {
            color: #666;
            text-decoration: none;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .nav-item.active { color: #F0B90B; }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="header">
        MARKET <span>INSIGHT</span>
    </div>

    <div class="search-container">
        <input type="text" id="symbol-input" class="search-input" placeholder="ì˜ˆ: BTC, ETH, XRP">
        <button id="btn-search" class="search-btn">ì´ë™</button>
    </div>

    <div class="chart-card">
        <canvas id="myChart"></canvas>
    </div>

    <div class="info-card">
        <div class="badge" id="coin-name">BTC / USDT</div>
        <div class="price-text" id="price-display">Loading...</div>
        <div class="status-text" id="status-msg">ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²° ì¤‘...</div>

        <div class="score-row">
            <span>AI ë¶„ì„ ì ìˆ˜</span>
            <span class="score-val" id="ai-score">--</span>
        </div>
        <div class="score-row">
            <span>ì¶”ì„¸ ê°•ë„</span>
            <span class="score-val" id="trend-strength">--</span>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <span class="nav-icon">ğŸ“Š</span>ê±°ë˜ì†Œ
        </a>
        <a href="wallet.html" class="nav-item">
            <span class="nav-icon">ğŸ’¼</span>ë‚´ ì§€ê°‘
        </a>
        <a href="ai-core.html" class="nav-item active">
            <span class="nav-icon">ğŸ§ </span>AIì„¤ì •
        </a>
        <a href="transfers.html" class="nav-item">
            <span class="nav-icon">ğŸ¦</span>ì…ì¶œê¸ˆ
        </a>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let ws = null;
        let chartData = [];
        let currentSymbol = 'btcusdt';
        let lastPrice = 0;

        // 1. í˜ì´ì§€ ì—´ë¦¬ë©´ ë°”ë¡œ ì‹œì‘
        window.addEventListener('load', () => {
            connectBinance('btcusdt'); // ê¸°ë³¸: ë¹„íŠ¸ì½”ì¸

            // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById('btn-search').addEventListener('click', () => {
                const input = document.getElementById('symbol-input').value;
                if(input) {
                    let sym = input.trim().toLowerCase();
                    if(!sym.includes('usdt')) sym += 'usdt';
                    connectBinance(sym);
                }
            });
        });

        // 2. ë°”ì´ë‚¸ìŠ¤ ì—°ê²° í•¨ìˆ˜
        function connectBinance(symbol) {
            // ê¸°ì¡´ ì—°ê²° ëŠê¸°
            if(ws) ws.close();
            
            // ë°ì´í„° ì´ˆê¸°í™”
            chartData = [];
            currentSymbol = symbol;
            document.getElementById('coin-name').innerText = symbol.toUpperCase().replace('USDT', ' / USDT');
            document.getElementById('price-display').innerText = "Loading...";
            document.getElementById('status-msg').innerText = "ë°ì´í„° ìˆ˜ì‹  ì¤‘...";

            // ì›¹ì†Œì¼“ ì—°ê²°
            const url = `wss://stream.binance.com:9443/ws/${symbol}@trade`;
            ws = new WebSocket(url);

            ws.onopen = () => { console.log('ì—°ê²° ì„±ê³µ'); };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.p);

                updateUI(price);
                updateChart(price);
            };

            ws.onerror = () => {
                document.getElementById('status-msg').innerText = "ì¢…ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                document.getElementById('price-display').innerText = "Error";
            };
        }

        // 3. í™”ë©´ ìˆ«ì ì—…ë°ì´íŠ¸
        function updateUI(price) {
            const elPrice = document.getElementById('price-display');
            
            // ê°€ê²© í‘œì‹œ (ì½¤ë§ˆ ì¶”ê°€)
            elPrice.innerText = '$ ' + price.toLocaleString(undefined, {minimumFractionDigits: 2});

            // ìƒ‰ìƒ ë³€ê²½ (ìƒìŠ¹:ì´ˆë¡, í•˜ë½:ë¹¨ê°•)
            if(lastPrice > 0) {
                elPrice.style.color = price >= lastPrice ? '#0ecb81' : '#f6465d';
            }
            lastPrice = price;

            // AI ì ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ (ëœë¤ ì—°ì¶œ)
            if(Math.random() > 0.7) { // ê°€ë”ì”©ë§Œ ë³€ê²½
                const score = Math.floor(Math.random() * 40) + 50; // 50~90ì 
                document.getElementById('ai-score').innerText = score + ' / 100';
                
                let strength = "ì¤‘ë¦½ (Neutral)";
                if(score > 80) strength = "ê°•ë ¥ ë§¤ìˆ˜ (Strong Buy)";
                else if(score > 60) strength = "ë§¤ìˆ˜ ìš°ìœ„ (Buy)";
                else if(score < 40) strength = "ë§¤ë„ ìš°ìœ„ (Sell)";
                
                document.getElementById('trend-strength').innerText = strength;
            }
        }

        // 4. ì°¨íŠ¸ ê·¸ë¦¬ê¸° (ìº”ë²„ìŠ¤ API)
        function updateChart(price) {
            const canvas = document.getElementById('myChart');
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ë§ì¶¤
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            const w = canvas.width;
            const h = canvas.height;

            // ë°ì´í„° ìŒ“ê¸° (ìµœëŒ€ 60ê°œ ìœ ì§€)
            chartData.push(price);
            if(chartData.length > 60) chartData.shift();

            // ê·¸ë¦¬ê¸° ì‹œì‘
            ctx.clearRect(0, 0, w, h);
            
            if(chartData.length < 2) return;

            // ìµœëŒ€/ìµœì†Œê°’ ê³„ì‚° (Yì¶• ë²”ìœ„)
            const min = Math.min(...chartData);
            const max = Math.max(...chartData);
            const range = max - min || 1;

            ctx.beginPath();
            ctx.strokeStyle = '#0ecb81'; // ì°¨íŠ¸ ì„  ìƒ‰ìƒ
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';

            // ì„  ì‡ê¸°
            chartData.forEach((p, i) => {
                const x = (i / (chartData.length - 1)) * w;
                // ìœ„ì•„ë˜ ì—¬ë°± 20pxì”© ë‘ê³  ìœ„ì¹˜ ê³„ì‚°
                const y = h - 20 - ((p - min) / range) * (h - 40);
                
                if(i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // ê·¸ë¼ë°ì´ì…˜ ì±„ìš°ê¸° íš¨ê³¼
            ctx.lineTo(w, h);
            ctx.lineTo(0, h);
            ctx.fillStyle = 'rgba(14, 203, 129, 0.15)'; // ë°˜íˆ¬ëª… ì´ˆë¡
            ctx.fill();
        }
    </script>
</body>
</html>
